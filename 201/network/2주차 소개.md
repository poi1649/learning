
#### 저장-후-전달
대부분의 패킷 스위치는 저장-후-전달 방식을 선택한다.
이는 패킷의 첫 비트가 오자마자 다음 스위치로 전달하는 게 아니라, 모든 패킷을 온전히 받은 후 다음 스위치로 전달하는 것을 뜻한다.
이 때문에 한 패킷이 다른 종단 시스템까지 도달하는 데 걸리는 시간은 $(N + 1)L / R$ 이라고 볼 수 있다.

여기서 N 은 지나쳐가는 패킷 스위치의 수, L은 비트의 크기, R은 링크의 전송률을 뜻한다.

#### 회선 교환
패킷 교환과 다르게 어떤 링크를 항상 점유하고 있는 교환 방식을 말한다. 주파수를 통해 점유할 부분을 점하거나(FDM), 시간 슬롯을 나눠 점유할 부분을 정할 수 있다(TDM).

이러한 방식은 다음과 같은 단점을 가진다.
- 사용자가 한명만 있을 때는 당연히 패킷 교환보다 성능이 좋지 못하다.
- 사용자가 늘어나면 경로 상의 모든 링크에서 미리 점유한 부분을 다시 나눠야 하므로 복잡하다.
- 링크의 전송율은 ms 단위로 굉장히 높은데, 인터넷의 모든 사용자가 ms 단위로 동시에 접속할 확률은 굉장히 낮기 때문에 보통의 경우 패킷 교환 방식이 성능이 좋다.

#### ISP의 구조
종단 시스템은 액세스 네트워크를 통해 각각의 ISP 들과 연결된다.
또 이런 ISP 들은 각각의 ISP 끼리 연결되어야한다.
만약 작은 ISP 끼리 전부 연결하려고한다면, 이는 n^2 개의 연결을 필요로 한다.
이 때문에 우리는 어떤 계층의 모든 ISP를 상위 계층의 하나의 ISP에 연결한다.
이것이 네트워크 구조 1이다.

만약 상위 계층의 ISP가 늘어난다면, 하위 계층의 ISP들은 하나 이상의 상위 계층 ISP 에 연결한다. 
이것이 네트워크 구조2이다.

이러한 상위 계층의 ISP들은 당연히 서로 연결되어있어야 한다.

그런데, 모든 접속 네트워크과 이어진 ISP가 상위 계층 ISP에 직접 연결할 수는 없다.
이 때문에 중간 관리자 ISP를 두는데 이 구조를 네트워크 3이라고 한다.
이 때 중간 관리자 ISP를 지역 ISP 라고 한다.

각각의 상위 계층의 ISP 들은 PoP(Points of Presence)라는 라우터 집합을 가지고 있고, 하위 계층의 ISP들은 최소 하나의 라우터가 PoP에 연결되어야 한다.

하위 계층은 ISP들은 상위 계층의 ISP여러개에 연결될 수 있는데 이를 멀티 홈 방식이라고 한다.
이 상황에서 같은 계층의 가까운 ISP 들은 굳이 상위 계층을 거치지 않고 서로 피어링 할 수도 있는데, 이를 위해 사용되는 별도의 교환기가 IXP(Internet Exchange Point)라고 불린다.
이런 구조를 네트워크 4라고 부른다.

네트워크 5는 현재 우리의 인터넷의 구조를 기술하는 구조이다.
네트워크 5는 네트워크 4에서 CDN 이라는 거대한 네트워크가 추가된 형태다.
이는 ISP가 아닌 별도의 기업에서 구축한 거대한 네트워크로 이를 통해, 최종 사용자들에게 상위 계층 ISP를 거치지 않고 콘텐츠를 제공할 수 있게 됐다.
이는 네트워크 비용을 줄일 뿐 아니라, 최종 사용자에게 더 많은 통제권을 가질 수 있는 방법이다.

#### 패킷 교환 네트워크의 지연

패킷은 한 호스트에서 시작해 일련의 라우터(패킷 스위치)들을 지나 호스트에 도착한다.
이 과정에서 패킷이 여러 노드(호스트, 라우터를 포함)를 지나는데, 각 노드에서 노드까지 경로에서 다양한 지연을 겪게 된다.

지연은 크게 4종류가 있다.
노드 처리 지연(nodal process delay)
큐잉 지연(queueing delay)
전송 지연(transmission delay)
전파 지연(propagation delay)

이러한 지연을 통틀어 전체 노드 지연(total nodal delay)라고 부르기도 한다.

#### 처리 지연
패킷은 라우터에 전달되면, 라우터는 패킷의 출력 링크를 결정하기 위해 패킷을 조사한다.
이 조사과정의 지연을 처리지연이라고 한다.
이에는 패킷의 비트레벨 오류를 조사하는데 필요한 시간도 포함될 수 있고, 일반적으로 수 마이크로초가 걸린다.

이렇게 조사가 끝나면 해당 패킷을 적절한 링크 앞 큐(버퍼)로 보낸다.

#### 큐잉 지연
한 스위치는 여러개의 종단 시스템으로부터 패킷을 받는다.
만약 한 스위치에 연결된 링크로 여러 패킷이 나가려고 한다면, 그 중 한 패킷은 대기하여야하는데, 이 때 패킷이 대기하는 장소를 출력 버퍼라고 한다.

이 때, 패킷이 버퍼에서 대기하는 시간을 **큐잉지연** 이라고 한다.

보통 수 마이크로초에서 수 밀리초에 이른다.

만약 이 출력 버퍼가 이미 다른 패킷으로 가득 차 있다면, 패킷의 손실이 발생하게 된다.

큐잉 지연은 패킷단위로 측정하기에, 평균 큐잉 지연, 큐잉 지연의 분산, 큐잉 지연이 특정 값을 넘는지 등 통계값을 일반적으로 사용한다.
만약 패킷이 L 비트이고, 패킷이 도착하는 도착률이 a(패킷 /초) 일 때, 전송률 R 에 대해
$La/R > 1$ 이면, 큐의 길이는 장기적으로 무한대에 도달한다.
반대로 $La/R <=1$ 이라면, 큐잉 지연은 없을 것이다.
그렇지만 현실의 패킷은 일정 도착률대로 도착하지 않는다.
말 그대로 랜덤하게 도착하는데 만약 이 상황에서 여러개 패킷이 동시에 도착하면, n 번째 패킷의 큐잉 지연은
$(n -1) L/R$ 이 될 것이다.


#### 전송 지연
패킷을 라우터에서 링크로 밀어내는 데 필요한 시간을 **전송 지연** 이라고 한다.
패킷의 길이를 L bit, 링크의 전송률을 R bps이라고 하면 전송 지연은 $L/R$ 이다.
일반적으로 수 마이크로초에서 수 밀리초에 이른다.

#### 전파 지연
링크에 전해진 패킷은 다음 노드까지 링크를 따라 전달되는데, 링크의 처음부터 다음 노드까지 전파에 필요한 이 시간을 **전파 지연**이라고 한다.
전파 속도는 매체의 특성에 따라 다르며 보통 빛의 속도와 같거나 약간 작다.
$거리 / 속도$ 으로 표현된다. (거리는 노드사이의 거리, 속도는 매체의 전파속도를 뜻함)
일반적으로 수 밀리초에 이른다.

