
#### P2P
P2P 는 다음과 같은 특징을 가지는 아키텍쳐이다.

- 서버가 언제나 켜져 있지 않다.
- 임의의 종단 시스템끼리 소통한다.
- 어떤 peer(종단 시스템)이 정보를 요청하는 주체가 될 수도, 전달하는 주체가 될 수도 있다.
- peer들은 항상 연결되어 있지는 않으며, IP주소도 변경될 수 있다.

**P2P의 성능**
F 사이즈의 파일을 N개의 종단 시스템이 가지려고 할 때, 클라이언트 서버 구조라면 최소 
$max(F/d_m, NF/U_s)$ 의 시간이 걸릴 것이다.
( $d_m$ 은 종단 시스템이 가진 다운로드율 중 가장 느린 다운로드율, $U_s$ 는 서버의 업로드율)
이는 N이 증가할 수록 이에 걸리는 시간도 선형적으로 증가함을 의미한다.

P2P 구조에서는 이 시간이 선형적으로 늘어나지 않는다.
P2P 구조에서 같은 작업을 하는 데 걸리는 최소 시간은 다음과 같다.
$max(F/d_m, F/U_s, NF/U_1 + U_2 + U_3 + ... + U_n)$ 
이는 각 종단 시스템이 청크를 받자 마자 업로드 할 수 있다는 가정 하에 도출할 수 있는 시간이다. (시간의 하한) 

실제로 이 구조는 거의 가능한 구조이며 N이 늘어나도, 선형적으로 이 작업의 시간이 늘어나지는 않는 다는 것을 알 수 있다.

**BitTorrent**
BitTorrent는 P2P를 구현하는 대표적인 프로토콜이다.

각각의 피어들의 집합을 토렌트라고 부르며, 이 피어들은 처음 토렌트에 들어올 때, 트래커라는 중앙 관리 서버에게 자신의 정보를 전달한다.

트래커는 새로 등록된 피어에게 임의의 갯수의 IP 주소를 등록자에게 전달해주고, 새로운 피어는 이를 전달받아 동시에 TCP 연결을 체결한다. 
이 연결을 통해 주기적으로 각 피어들이 어떤 청크를 가지고 있는 지 목록을 제공 받으며, 이 목록에 있지만 자신에게 없는 청크를 해당 피어에게 요청하게 된다.

이 과정에서 제일 드문 파일을 가진 피어에게 먼저 요청을 보내는 등 최적화가 적용될 수 있다.

응답의 경우, 일반적으로 자신에게 데이터를 제공하는 비율이 제일 빠른 4개의 피어에게 자신이 가진 청크를 제공해준다. 이 4개의 피어를 활성화 되어있다고 표현한다.

각 피어는 일정 시간마다 활성화되지 않은 토렌트 내의 다른 피어에게 정보를 제공해보기도 하면서 해당 피어가 유지하는 활성화 목록에 들어갈 수도 있고, 그렇게 되면 그 임의의 피어 또한 먼저 정보를 제공한 피어의 활성화 목록에 들어갈 수도 있다.

이 과정을 반복하며 피어들은 가장 효율적으로 정보를 전달받을 수 있는 이웃을 유지한다.

#### CDN

비디오 스트리밍 트래픽은 인터넷 전체 트래픽의 80%라고 추측될 정도로 엄청나게 방대한 양이다.
이를 효율적으로 전달하기 위해 대부분의 스트리밍 회사들은 분산된 환경에서 어플리케이션단의 트릭을 이용한다.

이 구조를 자세하게 알아보기 전 먼저 비디오의 특성에 대해 알아보자.

**비디오**
비디오는 특정한 시간에 보여지는 연속된 이미지의 집합이다.
이미지는 여러개의 픽셀로 구성되어 있다. 
이미지를 효율적으로 전송하기 위해 여러가지 최적화 기법을 사용한다.
1. spatial -> 연속된 빨간색 픽셀 9칸으로 구성된 정보를 전송할 때 red,red,red,red,...,red가 아닌 red, 9 라고 전송
2. temporal -> 이번 이미지의 픽셀을 통째로 전송하는 것이 아니라 바로 이전 이미지에서 바뀐 부분의 픽셀만 전송

이러한 기법을 사용하면 비트레이트가 가변적일 수 있다.
이러한 가변 비트레이트를 VBR 이라고 한다.

**스트리밍**
스트리밍 되는 비디오는 한 번에 전송할 수 없다. 여러 시간에 걸쳐 전송한다. 그런데 이 과정에서 네트워크의 대역폭이 일정하지 않다.

이를 위해 클라이언트 측에는 버퍼가 존재하고, 이 버퍼를 통해 스트리밍 되는 이후의 데이터를 미리 받는다.

또 비디오의 품질을 가변적으로 선택하는 DASH 라는 기능도 적용한다.
서버에서는 한 파일을 여러 개의 청크로 쪼갠 후, 각각 다른 품질을 가진 비디오로 미리 인코딩한다.
각 품질에 대한 비디오는 다른 URL을 가지는데, 이 비디오들의 정보를 manifest 파일을 통해 클라이언트에게 미리 제공한다.

**CDN**
이런 방대한 트래픽을 단일 서버에서 부담하게 되면 여러가지 문제가 발생한다.
SPOF, 클라이언트와의 물리적 거리 문제, 반복적인 송신문제 등.

이를 위해 컨텐츠 분산 네트워크(CDN)이 등장한다.

스트리밍에 CDN을 적용한 대표적인 서비스로는 YouTube, Netflix가 존재한다.

이 중 Netflix는 ISP와 IXP에 정적 컨텐츠를 서빙할 수 있는 많은 양의 서버랙을 배치하는 Enter Deep 방식을 채용했다.

또한, Local DNS를 기준으로 데이터를 제공받을 서버를 결정해주는 일반적인 방식이 아닌, 자사의 서버에서 이를 결정하는 방식을 채택했다.

각 CDN 서버의 캐싱 방식은 캐시 미스가 나면 동적으로 데이터를 요청하는 pull-caching이 아닌 push-caching 방식을 사용한 점이 특이하다.

