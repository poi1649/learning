**ì˜ì¡´ì„± ì •ë¦¬ ì „ í´ë˜ìŠ¤ êµ¬ì¡°**
```mermaid
classDiagram
    class Study {
    List<Round> rounds
	}

    class Round {
	Study study
	List<RoundMember> roundMembers
    }

    class RoundMember {
    Round round
    }

    Study -->  Round : contains
    Round --> Study : refers to
    RoundMember --> Round : refers to
    Round -->  RoundMember : contains

```

**ì˜ì¡´ì„± ì •ë¦¬ í›„ í´ë˜ìŠ¤ êµ¬ì¡°**
```mermaid
classDiagram
    class Study {
    }

    class Round {
        +Long studyId
        +List<RoundMember> roundMembers
    }

    class RoundMember {
        +Round round
    }

    Round ..> Study : refers to
    RoundMember --> Round : refers to
    Round --> RoundMember : contains

```


### ìŠ¤ì¼€ì¥´ë§ ë¡œì§

ìŠ¤ì¼€ì¥´ë§ ê¸°ëŠ¥ì˜ ëŒ€ëµì ì¸ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” Round(ìŠ¤í„°ë””ì˜ í•œ íšŒì°¨)ë¥¼ 'FINISHED' ìƒíƒœë¡œ ë°”ê¾¼ë‹¤.
2. ë°”ë¡œ ë‹¤ìŒ Roundë¥¼ 'IN PROGRESS' ìƒíƒœë¡œ ë°”ê¾¼ë‹¤.
3. í•„ìš”í•˜ë‹¤ë©´ ë‹¤ìŒ ì£¼ì˜ Roundë“¤ì„ ë¯¸ë¦¬ ìƒì„±í•œë‹¤.

ì´ ë¡œì§ì„ ìˆ˜í–‰í•˜ë˜ ê¸°ì¡´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
```java
List<Study> studies = studyRepository.findAllByProcessingStatus(ProcessingStatus.IN_PROGRESS);

studies.stream()
	   .filter(study -> study.isCurrentRoundEndAt(today))
	   .forEach(Study::proceedNextRound)
```

ì½”ë“œë§Œ ë³´ë©´ êµ‰ì¥íˆ ê¹”ë”í•˜ê³  ë³„ ë¬¸ì œ ì—†ì–´ë³´ì…ë‹ˆë‹¤.
í•˜ì§€ë§Œ ê¸°ì¡´ì—ëŠ” Studyê°€ Roundë¥¼ OneToManyë¡œ ê°€ì§€ê³  ìˆê³ , Roundë„ RoundMemberë¥¼ OneToManyë¡œ ê°€ì§€ê³  ìˆì–´, ìŠ¤í„°ë””ê°€ ì¡°ê¸ˆë§Œ ëŠ˜ì–´ë‚˜ë„ lazy loadingìœ¼ë¡œ ë§ë„ ì•ˆë˜ëŠ” ìˆ˜ì˜ ì¿¼ë¦¬ê°€ ìˆ˜í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ë¥¼ fetch joinìœ¼ë¡œ í•´ê²°í•˜ê¸°ì—” collection ë‘ ê°œë¥¼ fetchí•´ì˜¤ëŠ” ë°ì„œ ì œì•½ì´ ìˆì—ˆê³ , eager loadingì„ ì‚¬ìš©í•˜ë©´ ë‹¤ë¥¸ ê¸°ëŠ¥ì˜ ì„±ëŠ¥ì´ ì˜ˆìƒì¹˜ ëª»í•˜ê²Œ ì €í•˜ë  ìˆ˜ë„ ìˆë‹¤ëŠ” ì œì•½ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ë ‡ì§€ë§Œ ì´ë²ˆì— Roundë¥¼ Studyë¡œë¶€í„° ë¶„ë¦¬í•´ë‚´ë©´ì„œ, í•µì‹¬ ê¸°ëŠ¥ì¸ ìŠ¤ì¼€ì¥´ë§ ê¸°ëŠ¥ ë˜í•œ ìµœì í™” í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ë¨¼ì € 1ë²ˆ ë¡œì§(í˜„ì¬ ë¼ìš´ë“œ ì¢…ë£Œ)ì„ ìœ„í•´ ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” Roundë¥¼ ì°¾ì•„ì•¼í–ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ì—ëŠ” ìƒíƒœê°€ 'Processing' ì¸ Study ë¥¼ ì°¾ì•„ì™€ ì„œë²„ì—ì„œ í•„í„°ë§í–ˆì§€ë§Œ, Round ì•ˆì— ìš”ì¼ì´ ìˆì—ˆê¸° ë•Œë¬¸ì— ì´ë¥¼ í™œìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•„í„°ë§ í›„ ì°¾ì•„ì˜¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ ë©”ì„œë“œì™€ ìˆ˜ì •í•œ ë©”ì„œë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Spring Data JPAë¥¼ ì‚¬ìš©í•˜ì˜€ê¸°ì— Repository ì¸í„°í˜ì´ìŠ¤ì— ë³„ë„ì˜ ë©”ì„œë“œ ë³¸ë¬¸ì€ ì‘ì„±í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

```java
// ê¸°ì¡´ ë©”ì„œë“œ 
List<Study> studies = studyRepository.findAllByProcessingStatus(ProcessingStatus.PROCESSING);

// ìˆ˜ì • í›„ ë©”ì„œë“œ 
List<Round> rounds = roundRepository.findByRoundStatusAndDayOfWeek(  
    RoundStatus.IN_PROGRESS,  
    today.getDayOfWeek()  // today -> LocalDate.now();
);

```

2ë²ˆ ë¡œì§(ë‹¤ìŒ ë¼ìš´ë“œ ì§„í–‰), 3ë²ˆ ë¡œì§ì„ ìœ„í•´ì„œëŠ” ì´ë²ˆ ì£¼ì°¨, ë‹¤ìŒ ì£¼ì°¨ì˜ Roundê°€ ì „ë¶€ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ì œì•½, ì¡°ê±´ì´ ìˆì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

- ë‹¤ìŒ Roundë¥¼ ì°¾ìœ¼ë ¤ë©´ ê°™ì€ study_id(FK)ë¥¼ ê°€ì§„ Round ì¤‘ idê°€ í˜„ì¬ Round ë³´ë‹¤ ë°”ë¡œ ë‹¤ìŒìœ¼ë¡œ í° Roundë¥¼ ì°¾ì•„ì•¼ í•¨.
	- auto_increment idì— ì˜ì§€í•˜ëŠ” ë¬¸ì œ, ì¿¼ë¦¬ê°€ ë³µì¡í•´ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ
- ê° Round ê°€ ìì‹ ì˜ ìš”ì¼ë§Œ ê°€ì§€ê³  ìˆìœ¼ë©°, ë‹¤ë¥¸ Roundê°€ ì–´ë–¤ ìš”ì¼ì— ì§„í–‰ë˜ëŠ”ì§€ëŠ” ì•Œì§€ ëª»í•¨.
	- í˜„ì¬ ìš°ë¦¬ íŒ€ì˜ ê·œì¹™ ìƒ, ì´ë²ˆ ì£¼ Roundê°€ ì „ë¶€ ì¢…ë£Œë˜ì–´ ë‹¤ìŒ ì£¼ë¡œ Roundê°€ ì´ë™í–ˆì„ ë•Œ, ê·¸ ë‹¤ìŒ ì£¼ì˜ Roundë¥¼ ì „ë¶€ ë§Œë“¤ì–´ì£¼ì–´ì•¼ í–ˆê¸°ì—, í•´ë‹¹ ìŠ¤í„°ë””ì— ì†í•œ Roundì˜ ëª¨ë“  ìš”ì¼ì´ í•„ìš”.

ì´ ì¡°ê±´ë“¤ì„ ì§€í‚¤ë©° ì¬êµ¬ì„±í•œ ì „ì²´ ë¡œì§ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” Roundë¥¼ ì „ë¶€ ì¡°íšŒí•œë‹¤.
	1. **ì¡°íšŒ** ì¿¼ë¦¬ 1ë²ˆ ë°œìƒ -> 1
2. í•´ë‹¹ Roundì™€ ê°™ì€ studyIdë¥¼ ê°–ëŠ”, ì´ë²ˆ ì£¼ì°¨ì™€ ë‹¤ìŒ ì£¼ì°¨ì˜ Roundë¥¼ ì „ë¶€ ì¡°íšŒí•œë‹¤.
	1. 1ë²ˆì—ì„œ ì¡°íšŒëœ Round ìˆ˜ ë§Œí¼ **ì¡°íšŒ** ì¿¼ë¦¬ ë°œìƒ  -> N
3. ë°”ë¡œ ë‹¤ìŒ Roundë¥¼ ì°¾ëŠ”ë‹¤.
4. ì´ë²ˆ Roundë¥¼ ì¢…ë£Œì‹œí‚¤ê³  ë‹¤ìŒ Roundë¥¼ ì§„í–‰ì‹œí‚¨ë‹¤.
	1. 1ë²ˆì—ì„œ ì¡°íšŒëœ `Round ìˆ˜ * 2 `ë§Œí¼ **ìˆ˜ì •** ì¿¼ë¦¬ ë°œìƒ -> 2N
5. ë§Œì•½ ì´ë²ˆ Roundì™€ ì¢…ë£Œëœ Roundì˜ ì£¼ì°¨(weekNumber)ê°€ ë‹¤ë¥´ë‹¤ë©´, ì´ë²ˆ ì£¼ì°¨ì— í•´ë‹¹í•˜ëŠ” Roundë¥¼ ì „ë¶€ ë³µì‚¬í•˜ê³ , ì£¼ì°¨ë§Œ ìˆ˜ì •í•˜ì—¬ ëª¨ë“  ìš”ì¼ì˜ Roundê°€ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆê²Œ í•œë‹¤.
	1. ë³µì‚¬ì‹œ ì •ë³´ ì¡°íšŒë¥¼ ìœ„í•´ Roundì— ì°¸ì—¬í•˜ëŠ” ë©¤ë²„ë“¤ ìˆ˜(2 ~ 8) * 1ë²ˆì—ì„œ ì¡°íšŒëœ Round ìˆ˜ ë§Œí¼ lazy loadingìœ¼ë¡œ ì¸í•œ **ì¡°íšŒ** ì¿¼ë¦¬ ë°œìƒ -> ìµœëŒ€ 8N
	2. Round ìƒì„±ì‹œ 1ì£¼ë‹¹ ì§„í–‰í•˜ëŠ” Round ìˆ˜(1 ~ 7) * 1ë²ˆì—ì„œ ì¡°íšŒëœ Round ìˆ˜ ë§Œí¼ **ì‚½ì…** ì¿¼ë¦¬ ë°œìƒ -> ìµœëŒ€ 7N
	3. RoundMember ìƒì„±ì‹œ 1ì£¼ë‹¹ ì§„í–‰í•˜ëŠ” Round ìˆ˜ (1~7) * Roundì— ì°¸ì—¬í•˜ëŠ” ë©¤ë²„ë“¤ ìˆ˜(2 ~ 8) * 1ë²ˆì—ì„œ ì¡°íšŒëœ Round ìˆ˜ ë§Œí¼ **ì‚½ì…** ì¿¼ë¦¬ ë°œìƒ -> ìµœëŒ€ 56N 

ì „ë¶€ í•©ì³ ìµœëŒ€ 74N + 1 ê°œì˜ ì¿¼ë¦¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

ë¨¼ì € ê°€ì¥ ê°„ë‹¨í•´ë³´ì´ëŠ” 5-1ë²ˆ ì¿¼ë¦¬(lazy loadingìœ¼ë¡œ ì¸í•œ N+1 ì¿¼ë¦¬)ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Roundë¥¼ ì¡°íšŒí•  ë•Œ RoundMemberë¥¼ í•¨ê»˜ ì¡°íšŒí•´ì˜¤ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.
Roundë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ê³³ì—ì„œ RoundMemberê°€ í•„ìš”í•œ ê²ƒì€ ì•„ë‹ˆì—ˆê¸° ë•Œë¬¸ì— eager loadingëŒ€ì‹  EntityGraphë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
List<Round> nextWeekRounds = createNextRounds(upcomingCandidates);
```

```java
@EntityGraph(attributePaths = "RoundMember")  
List<Round> findByStudyIdInAndRoundStatus(Collection<Long> studyId, RoundStatus roundStatus);
```

ì´ë¥¼ í†µí•´ 7Nê°œì˜ ì¡°íšŒì¿¼ë¦¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.


ë‹¤ìŒìœ¼ë¡œ 65Nê°œì˜ ì‚½ì…ê³¼ ìˆ˜ì • ì¿¼ë¦¬ê°€ ë”°ë¡œë”°ë¡œ ë‚˜ê°€ëŠ” ë¬¸ì œëŠ” batch insert, batch updateë¡œ í•´ê²°í•˜ë©´ ì¢‹ê² ë‹¤ëŠ” ê²°ë¡ ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤. 

ë¡œì§ì„ ìˆ˜ì •í•´ Round ìƒì„± ê·œì¹™ê³¼ ì£¼ê¸°ë¥¼ ë°”ê¾¼ë‹¤ê±°ë‚˜ í•˜ëŠ” ë°©ë²•ë„ ìˆì—ˆì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ ì¸¡ì˜ ìˆ˜ì •ì´ ë™ë°˜ë˜ì–´ì•¼í•˜ê¸°ì— ì±„íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

Insertê°™ì€ ê²½ìš° jdbcTemplateì„ ì‚¬ìš©í•œ ë³„ë„ì˜ batchRepositoryë¥¼ êµ¬í˜„í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ê·¸ë ‡ì§€ë§Œ, Jpaì˜ ë”í‹° ì²´í‚¹ì„ í™œìš©í•œ updateì˜ ê²½ìš°ì—ëŠ” ì—”í‹°í‹°ë¥¼ detach í•´ì£¼ì–´ì•¼í•˜ëŠ” ê·€ì°®ìŒë„ ìˆê³ , ë˜ updateAll ê°™ì€ ë©”ì„œë“œê°€ repositoryì— ìˆëŠ” ê²ƒë„ ì–´ìƒ‰í•˜ë‹¤ê³  ìƒê°í•˜ì—¬ JPAì˜ batch_size ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

```java
spring:  
  jpa:  
    properties:  
      hibernate:  
        jdbc:  
          batch_size: 500    
```

ì´ë¥¼ ìœ„í•´ ì‚½ì…ë˜ëŠ” ì—”í‹°í‹°ì˜ Id ìƒì„± ì „ëµë„ TABLE ì „ëµìœ¼ë¡œ ë°”ê¿”ì£¼ì—ˆìŠµë‹ˆë‹¤.

idì˜ allocation sizeê°€ ê¸°ë³¸ê°’(50) ì¼ ë•Œ, 700ê°œì˜ Roundë¥¼ ì‚½ì…í•˜ê¸° ìœ„í•´ id ì±„ë²ˆì„ 14ë²ˆ ìˆ˜í–‰í•´ì•¼í–ˆìŠµë‹ˆë‹¤.
ì´ ê³¼ì •ì—ì„œ (Idì½ê¸° 1ë²ˆ, ë°˜ì˜ ì¿¼ë¦¬ 1ë²ˆ) ê° ì±„ë²ˆ ì‘ì—… ë‹¹ 2ë²ˆì˜ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ì—¬ ì´ 28ê°œì˜ ì¿¼ë¦¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

ì´ ìˆ˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ allocationSize ë˜í•œ batch_sizeì™€ ë™ì¼í•œ 500ìœ¼ë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
  
@GeneratedValue(strategy = GenerationType.TABLE, generator = "sequence_generator")  
@TableGenerator(name = "sequence_generator", table = "round_sequence",  
    pkColumnName = "sequence_name", pkColumnValue = "id",  
    initialValue = 1, allocationSize=500)  
@Id  
private Long id;
```


ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ê³¼ì •ì„ ë°˜ì˜í•´ ì‘ì„±ëœ ìŠ¤ì¼€ì¥´ë§ ë¡œì§ì˜ ì „ì²´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```java
// ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” ë¼ìš´ë“œ ì „ë¶€ ì¡°íšŒ
List<Round> rounds = roundRepository.findByRoundStatusAndDayOfWeek(  
        RoundStatus.IN_PROGRESS,  
        today.getDayOfWeek()  
);

for (Round round : rounds) {  

    // ì´ë²ˆ ì£¼ì°¨ì™€ ë‹¤ìŒ ì£¼ì°¨ Round ì „ë¶€ ì¡°íšŒ
    List<Round> upcomingCandidates = roundRepository.findByStudyIdAndWeekNumberIn(  
            round.getStudyId(),   
            List.of(currentWeek, currentWeek + 1)  
    );  

	// ë°”ë¡œ ë‹¤ìŒ Round ì¡°íšŒ
    Round upcomingRound = findUpcomingtRound(upcomingCandidates);
                                                      
	// round êµëŒ€(ìƒíƒœ ë³€ê²½)
	// ë°˜ë³µì´ ëë‚˜ê³  batch updateë¥¼ ìœ„í•´ ë³„ë„ì˜ ì»¬ë ‰ì…˜ì— ì¶”ê°€
	willBeFinished.add(round);  
	willProgress.add(upcomingRound);
    

	// ë§Œì•½ í•œ ì£¼ì˜ ëª¨ë“  Roundê°€ ëë‚¬ë‹¤ë©´, ê·¸ ë‹¤ìŒì£¼ì˜ Round ìƒì„±
    if (!upcomingRound.isSameWeek(currentWeek)) {  
        List<Round> nextWeekRounds = upcomingCandidates.stream()  
                                                       .filter(candidate -> candidate.isSameWeek(currentWeek + 1))  
                                                       .map(Round::createNextWeekRound)  
                                                       .toList();  
	    // ë°˜ë³µì´ ëë‚˜ê³  batch insertë¥¼ ìœ„í•´ ë³„ë„ì˜ collectionì— ì¶”ê°€
        nextWeekRoundsAll.addAll(nextWeekRounds);  
  
    }  
}
```

ê·¸ëŸ°ë° ì˜ˆìƒê³¼ëŠ” ë‹¤ë¥´ê²Œ batch updateë¡œì§ì´ ë˜‘ë°”ë¡œ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì´ëŠ” ë§¤ ë°˜ë³µë§ˆë‹¤ roundRepository ì˜ find ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— dbì™€ í†µì‹ í•  ë•Œ, ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— ìˆëŠ” ì—”í‹°í‹°ë“¤ì´ flushë˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ì¼ì´ì—ˆìŠµë‹ˆë‹¤.

```java
    List<Round> upcomingCandidates = roundRepository.findByStudyIdAndWeekNumberIn(  
            round.getStudyId(),   
            List.of(currentWeek, currentWeek + 1)  
    );  
```

ê²°êµ­, ë°˜ë³µë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ì¡°íšŒ ì¿¼ë¦¬ë„ í•¨ê»˜ ì¤„ì´ê¸° ìœ„í•´ ì´ ë¶€ë¶„ì„ ê°œì„ í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

ê°œì„  ì‘ì—…ì— ëŒ€í•œ íŒíŠ¸ëŠ” ìš°ë¦¬ ì„œë¹„ìŠ¤ì˜ ê·œì¹™ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

*> ì´ë²ˆ ì£¼ Roundê°€ ì „ë¶€ ì¢…ë£Œë˜ì–´ ë‹¤ìŒ ì£¼ë¡œ Roundê°€ ì´ë™í–ˆì„ ë•Œ, ê·¸ ë‹¤ìŒ ì£¼ì˜ Roundë¥¼ ì „ë¶€ ë§Œë“¤ì–´ì£¼ì–´ì•¼ í•œë‹¤.* 

ì´ ê·œì¹™ì€ ***'ì¢…ë£Œë˜ì§€ ì•Šì€ RoundëŠ” ëª¨ë‘ ì´ë²ˆ ì£¼ì™€ ë‹¤ìŒ ì£¼ Round ì´ë‹¤'*** ë¼ê³ ë„ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ ì „ì²´ ë¡œì§ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```java
// ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” Round ì—ì„œ studyIdë¥¼ ì¶”ì¶œí•˜ê³ , ëë‚˜ì§€ ì•Šì€ Roundë¥¼ ì „ë¶€ ì¡°íšŒ
List<Round> rounds = roundRepository.findByRoundStatusAndDayOfWeek(  
        RoundStatus.IN_PROGRESS,  
        today.getDayOfWeek()  
);
List<Long> studyIds = rounds.stream()  
                            .map(Round::getStudyId)  
                            .toList();
                            
// studyIdë¡œ Groupingí•¨.
Map<Long, List<Round>> notStartedRounds = roundRepository.findByStudyIdInAndRoundStatus(studyIds, RoundStatus.NOT_STARTED)  
                                                         .stream()  
                                                         .collect(Collectors.groupingBy(Round::getStudyId));  

// ë°˜ë³µë¬¸ì´ ëë‚˜ê³  batch update, batch insertë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì„ì‹œ ì»¬ë ‰ì…˜
List<Round> nextWeekRoundsAll = new ArrayList<>();  
List<Round> willBeFinished = new ArrayList<>();  
List<Round> willProgress = new ArrayList<>();  

// ì˜¤ëŠ˜ ì¢…ë£Œë˜ëŠ” Roundë¥¼ í•˜ë‚˜ì”© ìˆœíšŒ
for (Round round : rounds) {  
    Integer currentWeek = round.getWeekNumber();  
    // studyIdë¡œ í•´ë‹¹ Roundì™€ ê°™ì€Studyì˜ ì¢…ë£Œë˜ì§€ ì•Šì€ Roundì˜ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
    List<Round> upcomingCandidates = notStartedRounds.get(round.getStudyId());  
  
	Round upcomingRound = findUpcomingRound(upcomingCandidates);
	
    willBeFinished.add(round);  
    willProgress.add(upcomingRound);  
  
    if (!upcomingRound.isSameWeek(currentWeek)) {  
        List<Round> nextWeekRounds = createNextRounds(upcomingCandidates);
        nextWeekRoundsAll.addAll(nextWeekRounds);  
    }  
}  

// update ìˆ˜í–‰
willBeFinished.forEach(Round::finish);  
willProgress.forEach(Round::proceed);  

// batch insert ìˆ˜í–‰
roundRepository.saveAll(nextWeekRoundsAll);

```


Study - 100ê°œ
Round ì§„í–‰ ìš”ì¼ - ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼
ì°¸ì—¬ì¸ì› - 8ëª… 

ìœ„ ê¸°ì¤€ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ ì¸¡ì •í•œ ì§€í‘œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
// ê¸°ì¡´ ë¡œì§ìœ¼ë¡œ ì¸¡ì •
// ìƒˆë¡œìš´ Roundê°€ ìƒì„±ë˜ì§€ ì•Šì„ ë•ŒëŠ” ì•½ ì´ˆ, ìƒì„± ë ë•ŒëŠ” ì•½ 0.1ì´ˆ ê±¸ë¦¼

time spent to proceed Round 
study size: 100
total time spent: 3537
The JVM is using 92 MB of memory.

time spent to proceed Round 
study size: 100
total time spent: 5429
The JVM is using 193 MB of memory.

```

```
// ë³€ê²½ëœ ë¡œì§ìœ¼ë¡œ ì¸¡ì •
// ìƒˆë¡œìš´ Roundê°€ ìƒì„±ë˜ì§€ ì•Šì„ ë•ŒëŠ” ì•½ 0.05ì´ˆ, ìƒì„± ë ë•ŒëŠ” ì•½ 0.1ì´ˆ ê±¸ë¦¼

time spent to proceed Round 
study size: 100
total time spent: 115
The JVM is using 174 MB of memory.

time spent to proceed Round 
study size: 100
total time spent: 51
The JVM is using 198 MB of memory.

time spent to proceed Round 
study size: 100
total time spent: 45
The JVM is using 121 MB of memory.

time spent to proceed Round 
study size: 100
total time spent: 138
The JVM is using 143 MB of memory.
```

ìˆ˜í–‰ë˜ëŠ” ì¿¼ë¦¬ì˜ ê°œìˆ˜ëŠ” 7301ê°œì—ì„œ 8ê°œë¡œ ì•½ 99.8% ê°ì†Œí–ˆê³ ,
ìˆ˜í–‰ ì‹œê°„ì€ 5.4ì´ˆì—ì„œ 0.1ì´ˆë¡œ ì•½ 98% ê°ì†Œí–ˆìŠµë‹ˆë‹¤.

ì‚¬ì‹¤ ì´ ê°œì„  ì‘ì—…ì€ ì½”ë“œë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‘ì„±í•˜ëŠ” ê²Œ ì•„ë‹ˆë©´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ê³  ëŠê»´ì§€ëŠ” ì‘ì—…ì´ì—ˆìŠµë‹ˆë‹¤.
ê³„ì†í•´ì„œ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ê³  ìˆ˜ì •ë˜ëŠ” ì¤‘, ì—”í‹°í‹°ê°„ì˜ ì—°ê´€ ê´€ê³„ë¥¼ ìˆ˜ì •í•˜ê¸°ê°€ êµ‰ì¥íˆ ê¹Œë‹¤ë¡œì› ê¸° ë•Œë¬¸ì¸ë°, ìš°ì—°íˆ ì°¸ê°€í•œ ìš°ì•„ì½˜ì—ì„œ ì ì§„ì  ëª¨ë“ˆ ë¶„ë¦¬ì— ëŒ€í•œ ë°œí‘œë¥¼ ë“£ê³  ì´ë¥¼ í•´ê²° í•  ì•„ì´ë””ì–´ë¥¼ ì–»ì—ˆë˜ ê²Œ ì§€ê¸ˆ ìƒê°í•´ë³´ë©´ êµ‰ì¥í•œ í–‰ìš´ì´ì—ˆìŠµë‹ˆë‹¤.

ì—­ì‹œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ê²½í—˜ì„ ë“£ëŠ” ê±´ í° ê³µë¶€ê°€ ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.ğŸ‘

