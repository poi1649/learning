

## 사용자 식별

MySQL 에서는 사용자를 아이디와 접속지점(클라이언트가 실행된 호스트명, 도메인 또는 ip 주소)을 통해 식별한다.

다음과 같은 예시처럼 아이디와 접속지점은 @를 통해 구분되고, 이를 ` 이나 ‘ 로 감싸서 표시한다.

`my_id`@`127.0.0.1`

위의 my_id는 명시한 대로, localhost에서만 mysql 에 접속할 수 있는 계정이 된다.

만약 모든 ip 에서 접속하고 싶다면 ‘%’ 로 접속 지점 부분을 수정해주면 된다.

> 같은 id 에 대해 두 가지 호스트가 존재한다면, MySQL에 접속할 때는 접속 지점이 좁은 곳에서만 사용가능한 계정이 된다.

## 인증 방식

mysql 에서는 기본적으로 4가지 인증 방식이 존재한다.

**Native Pluggable Authentication**

MySQL 5.7 까지 기본으로 사용되던 인증방식이다. 단순 비밀번호에 대한 해시 값(SHA-1 알고리즘)을 저장해두고, 클라이언트가 보낸 값과 일치하는지 검사한다.

**Caching SHA-2 Pluggable Authentication**

MySQL 5.6에서 도입되고, 8.0에서 보완된 기본 인증방식이다. SHA-2 알고리즘을 통해 해시값을 생성한다. 내부적으로 Salt키를 활용하여 수천번의 해시계산을 수행해서 결과를 만들어내기때문에, 동일한 키값에 대해서도 연산마다 결과가 달라진다. 보안적으로 안전할 수 밖에 없다.

다만, 많은 연산횟수 때문에 성능상 단점이 있는데, 이를 Caching을 통해 보완하고 있다. 이 인증 방식을 사용하기 위해서는, 리모트 연결을 할 때 SSL 연결을 하거나, RSA 키페어를 사용하여 연결해야한다.

(이 방식을 사용하면 REQUIRE 옵션이 false더라도 항상 암호화된 채널만으로 접속이 허용된다.)

**PAM Pluggable Authentication**

유닉스 , 리눅스 패스워드 + LDAP 같은 외부 인증을 사용할 수 있게 해준다. 엔터프라이즈 에디션에서만 사용 가능하다.

**LDAP Pluggable Authentication**

LDAP 를 통한 외부 인증을 사용하게 해준다. 엔터프라이즈 에디션에서만 사용 가능하다.

## Account Lock 컬럼과 Role

MySQL 에서는 Account Lock 컬럼을 통해 계정의 사용을 금지할 수도 있다.

Lock 이 걸려있는 계정으로는 MySQL서버에 접속할 수 없다.

특이한 점은, 권한의 모음이라고 볼 수 있는 Role이 User와 같은 테이블에서 관리되며, 전부 Lock 이 걸려있다는 점이다.

이는 사용자끼리의 권한 병합을 편하게 하기 위함이다.

하지만 이 때문에 User 에 대한 권한을 가진 사람은 Role 도 자유롭게 생성할 수 있지 않을까 하는 의문이 드는데, 이를 위해 MySQL 에서는 CREATE ROLE 과 CREATE USER 를 서로 다른 명령으로 관리한다. 즉, 권한도 세분화하여 관리한다.

## 달리는 마차 바퀴 갈아 끼우기

만약 배포중인 서버에서 사용하고 있는 db 접속 비밀번호를 바꾸고 싶다면 어떻게 해야할까?

서버가 가진 정보를 먼저 수정하든, db를 먼저 수정하든 서버는 잠깐 에러가 발생할 수 밖에 없다.

이를 위해, MySQL에서는 Dual Password 라는 옵션을 지원한다.

이는 비밀번호를 변경할 때, 기존에 사용하던 비밀번호도 임시로 사용할 수 있게 하는 옵션이다.

이를 통해, db 의 비밀번호를 Dual Password 옵션을 준 상태로 먼저 수정하고, 서버의 비밀번호 정보를 변경해준 뒤, Dual Password를 폐기하는 방식으로 달리는 마차의 바퀴를 갈아 끼울 수 있다.